\chapter{文件结构}
在这一章中，我们将讨论文件的结构。基于不同的应用，使用多种方法，文件被存储在辅助存储设备中。我们还将讨论当个记录是如何被检索的。本章是下一章的前序，下一章将讨论相关文件的集合是如何组织和存取的。

文件存储在辅助存储设备或二级存储设备中。两种最常见的二级存储设备是磁盘和磁带。文件在二级存储设备中是可读写的。文件也可以以计算机只能写不能读的形式存在。例如，在系统监视器上显示的信息，就是一种类似于发送到打印机的数据形式的文件。广义上，键盘也是文件，虽然它并不能存储数据。

按照我们的意图，文件是数据记录的集合，每一个记录都由一个或多个域组成。就像第11章中定义的一样。

再设计一个文件时，关键问题是如何从文件中检索信息。有时需要一个接一个地处理记录，有时又需要快速存取一个特定的记录而不用检索前面的记录。存取的方法决定了怎样检索记录：顺序或者随机的。

如果需要顺序地存取记录，则使用顺序文件结构。

如果想存取某一个特定记录而不用检索其之前的所有记录，则使用允许随机存取的文件结构。有两种文件结构都允许随机存取：索引文件和散列文件。文件结构的分类方法参见图。

顺序文件是指记录只能按照顺序从头到尾一个接一个地进行存取。记录被一个接一个地存储到辅助存储器中，并在最后的记录加上EOF的标志。操作系统没有有关记录地址的信息，它只知道记录是一个挨着一个存取的。

顺序文件用于需要从头到尾存取记录的应用。例如，如果公司里每个职员个人资料存储于一个文件中，月底就可以通过顺序存取检索每条记录来打印工资。在这里，因为必须处理每一条记录，所以顺序存取比随机存取更简便有效。

顺序文件必须定期更新，已反映信息的变化。更新过程将非常棘手，因为所有记录都要被顺序地检查和更新。

和更新程序有关的一共有4个文件：新主文件、旧主文件、实务文件和错误报告文件。所有这些文件根据关键字值被分类。虽然我们用了磁带的符号表示文件，但是我们可以更容易永磁盘的符号表示。

要使文件更新过程有效率，所有文件都必须按同一键排序。

在文件中随机存取记录，需要知道记录的地址。例如，一个客户想要查询银行账户。客户和出纳员都不知道客户记录的地址。客户只能给出纳员自己的账号。这里，索引文件可以把账号和记录地址关联起来。

目录是大多数操作系统提供的，用来组织文件。目录完成的功能就像是档案柜中的文件夹一样。但是，在大多数操作系统中，目录被表示为含有其他文件信息的一种特殊文件类型。目录的作用不仅仅像一种索引文件，该索引文件告诉操作系统文件在辅助存储设备上的位置，目录还包含了关于它所包含的文件的其他信息，如：谁有访问文件的权限，文件被创建、存取和修改的日期。

在大多操作系统中，目录被组织成像树的抽象数据类型（ADT），这种抽象数据类型在第12章中讨论过，其中除根目录外每个目录都有双亲。包含在另一个目录中的目录称为包含目录的子目录。

根目录

主目录

工作目录

父目录

文件系统的每个目录和文件都必须有一个名字。

在结束这章之前，我们讨论两个用于文件分类的术语：文本文件和二进制文件。存储在存储设备上的文件是一个位的序列，可被应用程序翻译成一个文本文件或是二进制文件。

文本文件是一个字符文件。在他们的内存储器格式中不能包含整数、浮点数或其他数据结构。要存储这些类型的数据，必须把它们转换成对应的字符格式。

一些文件只能用字符数据格式。值得注意的是用于键盘、监视器和打印机的文件流。这也是为什么需要特殊的函数来格式化上述设备的输入或输出数据。

让我们来看这样一个例子，当数据（文件流）传给打印机时，打印机获得8位数据，解释成1字节。将其译码成打印机的编码系统（ASCII或EBCDIC），如果字符处于可打印的种类，它将被打印；否则，将执行另外的操作，如打印空白。然后，打印机将读取下一个8位数据，一次重复该过程知道数据流结束。

二进制文件是计算机的内部格式存储的数据集合，在这种定义中，数据可以是整型（包括其他表示成无符号整数的数据类型，例如图像、音频或视频）、浮点型或其他数据结构（除了文件）。

不想文本文件，二进制文件中的数据只有当被程序正确地解释时才有意义。如果数据是文本格式的，就用一个字节来表示一个字符。如果数据是数字格式的，则用两个或是更多字节来表示一个数据项。
